<!-- Stock Chart Partial -->
<canvas id="stockChart" height="200"></canvas>


<script>
let ctx = document.getElementById('stockChart').getContext('2d');
let chart;

// create chart on page load
$(document).ready(function() {
  fetch('/historicaldata?symbol={{info.symbol}}&range=1y', {
    method: 'GET',
  }).then(function(result) {
    result.json().then(function(json) {
      createChart(json.dates, json.prices);
    });
  });
});

function createChart(dates, prices) {
  chart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: dates,
      datasets: [{
        lineTension: 0,
        data: prices,
        backgroundColor: 'rgba(0, 192, 192, 0.2)',
        borderColor: 'rgba(75, 192, 192, 1)',
        borderWidth: 2
      },
      {
        // lineTension: 0,
        // data: prices,
        // showLine: false
        // backgroundColor: ['rgba(75, 192, 192, 0.2)'],
        // borderColor: ['rgba(75, 192, 192, 1)'],
        // borderWidth: 2
      }]
    },
    options: {
      legend: {
        display: false
      },
      elements: {
        point:{
          radius: 0
        }
      },
      scales: {
        yAxes: [{
          scaleLabel: {
            labelString: "Price",
            display: true
          },
          gridLines: {
            borderDash: [8, 4]
          }
        }],
        xAxes: [{
          type: "time",
          ticks: {
            autoSkip: true,
            maxTicksLimit: 20
          },
          time: {
            displayFormats: {'day': 'MM/YY'},
            tooltipFormat: 'MMM D, YYYY',
            unit: 'month',
          },
          gridLines: {
            display: false
          },
          scaleLabel: {
            labelString: "Date"
          }
        }]
      },
      tooltips: {
        mode: 'index',
        intersect: false
      },
      hover: {
        mode: 'index',
        intersect: false
      }
    }
  });
}

function updateDateRange(event, range) {
  var prevRange = document.getElementsByClassName('nav-link active');
  $(prevRange[0]).removeClass('active')

  $(event).addClass('active');

  fetch('/historicaldata?symbol={{info.symbol}}&range=' + range, {
    method: 'GET',
  }).then(function(result) {
    result.json().then(function(json) {
      // update chart
      chart.destroy();
      createChart(json.dates, json.prices);
    });
  });
}

</script>
